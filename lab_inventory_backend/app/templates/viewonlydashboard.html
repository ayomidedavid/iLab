<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View-Only Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">
</head>
<body>
    <div class="container py-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h2 class="mb-0">Welcome, {{ current_user.username }}!</h2>
                <div class="muted">View-Only Dashboard</div>
            </div>
            <a href="/signout" class="btn btn-outline-secondary">Sign Out</a>
        </div>

        <!-- Inventory Summary -->
        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <div class="card card-gradient p-3 shadow-sm">
                    <div class="muted">Total Systems</div>
                    <div class="stat-number">{{ total_systems or 0 }}</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-gradient p-3 shadow-sm">
                    <div class="muted">Active</div>
                    <div class="stat-number text-success">{{ active_count or 0 }}</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-gradient p-3 shadow-sm">
                    <div class="muted">Faulty</div>
                    <div class="stat-number text-danger">{{ faulty_count or 0 }}</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-gradient p-3 shadow-sm">
                    <div class="muted">Maintenance</div>
                    <div class="stat-number text-warning">{{ maintenance_count or 0 }}</div>
                </div>
            </div>
        </div>

        <!-- System Overview -->
        <div class="card mb-4 p-3 shadow-sm">
            <h5>System Overview</h5>
            <div class="table-responsive">
                <input class="form-control form-control-sm mb-2" type="search" id="systemSearch" placeholder="Search hostname..." oninput="filterSystems()">
                <table class="table table-hover align-middle mb-0" id="systemTable">
                    <thead class="table-light">
                        <tr><th>UUID</th><th>Hostname</th><th>Location</th><th>Status</th><th>Assigned To</th></tr>
                    </thead>
                    <tbody id="systemTableBody">
                        {% for system in systems %}
                        <tr>
                            <td>{{ system.uuid }}</td>
                            <td>{{ system.hostname }}</td>
                            <td>{{ system.location }}</td>
                            <td>{{ system.status }}</td>
                            <td>{{ system.assigned_to or '-' }}</td>
                        </tr>
                        {% else %}
                        <tr><td colspan="5" class="text-center text-muted">No systems available</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Notifications -->
        <div class="card mb-4 p-3 shadow-sm">
            <h5>Notifications</h5>
            <ul class="list-group list-group-flush">
                {% for note in notifications %}
                    <li class="list-group-item">{{ note.message }} <span class="text-muted small">{{ note.time }}</span></li>
                {% else %}
                    <li class="list-group-item text-muted">No notifications</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Maintenance Queue -->
        <div class="card mb-4 p-3 shadow-sm">
            <h5>Maintenance Queue</h5>
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr><th>System</th><th>Issue</th><th>Status</th><th>Technician</th></tr>
                    </thead>
                    <tbody>
                        {% for m in maintenance_list %}
                        <tr>
                            <td>{{ m.hostname }}</td>
                            <td>{{ m.issue_summary }}</td>
                            <td>{{ m.status }}</td>
                            <td>{{ m.technician or '-' }}</td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" class="text-center text-muted">No maintenance items</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="card mb-4 p-3 shadow-sm">
            <h5>Recent Activity</h5>
            <ul class="list-group list-group-flush">
                {% for act in recent_activity %}
                    <li class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <small class="text-muted">{{ act.time }}</small>
                            <small class="muted">{{ act.user }}</small>
                        </div>
                        <div>{{ act.message }}</div>
                    </li>
                {% else %}
                    <li class="list-group-item text-muted">No recent activity</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Profile Info -->
        <div class="card mb-4 p-3 shadow-sm">
            <h5>Profile Info</h5>
            <div><strong>Username:</strong> {{ current_user.username }}</div>
            <div><strong>Email:</strong> {{ current_user.email }}</div>
            <div><strong>Role:</strong> {{ current_user.role }}</div>
        </div>

        <!-- Reports -->
        <div class="card mb-4 p-3 shadow-sm">
            <h5>Reports</h5>
            <button class="btn btn-sm btn-outline-secondary" id="exportCsv">Export CSV</button>
            <button class="btn btn-sm btn-outline-secondary" id="exportPdf">Export PDF</button>
        </div>

        <script>
            function filterSystems() {
                var input = document.getElementById('systemSearch').value.toLowerCase();
                var rows = document.querySelectorAll('#systemTableBody tr');
                rows.forEach(function(row) {
                    var hostname = row.cells[1].textContent.toLowerCase();
                    row.style.display = hostname.includes(input) ? '' : 'none';
                });
            }
            document.getElementById('exportCsv')?.addEventListener('click', ()=> alert('Export CSV - implement server-side'));
            document.getElementById('exportPdf')?.addEventListener('click', ()=> alert('Export PDF - implement server-side'));
        </script>
    </div>
</body>
</html>
